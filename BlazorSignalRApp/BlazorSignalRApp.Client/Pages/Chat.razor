@page "/chat"
@rendermode InteractiveWebAssembly
@inject NavigationManager Navigation
@inject IJSRuntime JSRuntime

<PageTitle>Chat</PageTitle>

<p>Chat with people</p>

<div class="form-group">
	<label>
		Username:
		<input @bind="userName" />
	</label>
</div>
<label>
	Room:
	<input @bind="roomId" />
</label>
<button @onclick="JoinRoom">Join Room</button>

@code {
	private string? userName;
	private string? roomId;

	protected override async Task OnAfterRenderAsync(bool firstRender)
	{
		try
		{
			if (string.IsNullOrWhiteSpace(userName)) {
				userName = await JSRuntime.InvokeAsync<string>("localStorage.getItem", "chatUserName");
			}
		}
		catch
		{
			// Ignore errors during JS interop
		}
	}

	private void JoinRoom()
	{
		// Update URL without reloading the page
		if (!string.IsNullOrWhiteSpace(roomId))
		{
			Navigation.NavigateTo($"/chat/{roomId}", false);
		}
	}
}
